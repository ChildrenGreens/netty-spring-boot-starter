= Profiles
:page-pagination:

Profiles define the protocol stack for a server. A profile configures the Netty pipeline with appropriate handlers for a specific protocol.

== Built-in Profiles

[cols="2,1,3"]
|===
|Profile |Transport |Description

|`tcp-lengthfield-json`
|TCP
|4-byte length prefix + JSON codec

|`tcp-line`
|TCP
|Line-based framing (CRLF)

|`tcp-raw`
|TCP
|Raw TCP without framing

|`http1-json`
|HTTP
|HTTP/1.1 with JSON codec

|`websocket`
|HTTP
|WebSocket with JSON codec

|`udp-json`
|UDP
|UDP datagram with JSON codec
|===

== Profile Selection

Select a profile in your server configuration:

[source,yaml]
----
spring:
  netty:
    servers:
      - name: my-server
        transport: TCP
        port: 9000
        profile: tcp-lengthfield-json  # <-- Select profile here
----

== TCP Length-Field JSON

The `tcp-lengthfield-json` profile uses a 4-byte length prefix followed by JSON body:

[source,text]
----
+--------+------------------+
| Length |   JSON Body      |
| 4 bytes|   N bytes        |
+--------+------------------+
----

Message example:
[source,json]
----
{"type":"ping","data":"hello"}
----

== TCP Line-Based

The `tcp-line` profile uses newline (`\n` or `\r\n`) as message delimiter:

[source,text]
----
Message 1\r\n
Message 2\r\n
Message 3\r\n
----

== HTTP/1.1 JSON

The `http1-json` profile handles standard HTTP requests with JSON body:

[source,http]
----
POST /api/users HTTP/1.1
Content-Type: application/json

{"name":"John","email":"john@example.com"}
----

== WebSocket

The `websocket` profile handles WebSocket connections:

1. HTTP upgrade handshake
2. WebSocket frames (text/binary)
3. Close frame handling

== Custom Profile

Create a custom profile by implementing the `Profile` interface:

[source,java]
----
@Component
public class MyCustomProfile implements Profile {

    @Override
    public String getName() {
        return "my-custom-profile";
    }

    @Override
    public void configure(ChannelPipeline pipeline, ServerSpec serverSpec) {
        pipeline.addLast("myDecoder", new MyDecoder());
        pipeline.addLast("myEncoder", new MyEncoder());
    }

    @Override
    public String getProtocolType() {
        return NettyContext.PROTOCOL_TCP;  // or PROTOCOL_HTTP, PROTOCOL_WEBSOCKET, PROTOCOL_UDP
    }
}
----

Then use it in configuration:

[source,yaml]
----
spring:
  netty:
    servers:
      - name: my-server
        profile: my-custom-profile
----
